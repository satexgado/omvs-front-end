<div class="grid-container">
    <div class="sidebarlist" [class.sidebar_small]="selectedAuto">
        <div class="card card-2 card-accent-primary">
            <div class="d-flex align-items-center p-2  border-bottom">
                <input type="text" class="form-control form-control-sm" name="term" placeholder="recherche" [(ngModel)]="dataHelper.searchTerm" required aria-label="Batiment" aria-describedby="basic-addon2">
                <button class="btn btn-link" (click)="onChangeView('card')">
                    <span class="tx-primary">
                        <i
                        class="fad fa-th card-1 tx-16"
                        [ngClass]="
                            view == 'card' ? 'bg-primary text-white' : 'text-primary bg-white'
                        "
                        style="padding: 6px; border-radius: 50%"
                        ></i>
                    </span>
                    </button>
                    <button class="btn btn-link" (click)="onChangeView('list')">
                    <span class="tx-primary">
                        <i
                        class="fad fa-list card-1 tx-16"
                        [ngClass]="
                            view == 'list' ? 'bg-primary text-white' : 'text-primary bg-white'
                        "
                        style="padding: 6px; border-radius: 50%"
                        ></i>
                    </span>
                </button>
                <div [container]="'body'" ngbDropdown>
                    <button class="btn float-right mx-1 btn-outline-primary"
                        [class.btn-primary]="is_showing_filter" id="dropdownMenuButton" ngbDropdownToggle>
                        <i class="fas fa-filter"></i>
                    </button>
                    <div ngbDropdownMenu>
                        <form class="px-4 py-3" [formGroup]="configForm">
                            <div class="form-group">
                                <select class="custom-select" (change)="resetFormValue()" formControlName="type">
                                    <option value="affectataire_id">Affectataire</option>
                                    <option value="type_carburant">Carburant</option>
                                    <option value="conducteur_id">Chauffeur</option>
                                    <!-- <option value="disponibilite">Disponibilite</option> -->
                                    <option value="etat_id">Etat</option>
                                    <option value="coordonnee_id">Fournisseur</option>
                                    <option value="localisation">Localisation</option>
                                    <option value="genre">Genre</option>
                                    <option value="marque">Marque</option>
                                    <option value="modele">Modele</option>
                                    <option value="serie">Serie</option>
                                    <option value="type_automobile">Type</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <ng-container [ngSwitch]="configForm.get('type').value">
                                    <div [class.loading]="!(allTypeAutomobiles$ | async)"
                                        *ngSwitchCase="'type_automobile'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allTypeAutomobiles$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allGenre$ | async)"
                                        *ngSwitchCase="'genre'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allGenre$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allModele$ | async)"
                                        *ngSwitchCase="'modele'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allModele$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allMarque$ | async)"
                                        *ngSwitchCase="'marque'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allMarque$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allSerie$ | async)"
                                        *ngSwitchCase="'serie'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allSerie$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allCoordonnee$ | async)"
                                        *ngSwitchCase="'coordonnee_id'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allCoordonnee$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allEtatAutomobiles$ | async)"
                                        *ngSwitchCase="'etat_id'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allEtatAutomobiles$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allTypeCarburants$ | async)"
                                        *ngSwitchCase="'type_carburant'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allTypeCarburants$ | async)">
                                                <option [ngValue]="item">{{item.libelle}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allDossierConducteurs$ | async)"
                                        *ngSwitchCase="'conducteur_id'">
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allDossierConducteurs$ | async)">
                                                <option [ngValue]="item">{{item.conducteur?.nom }} {{item.conducteur?.prenom}} ({{item?.conducteur?.departement?.name}}-{{item?.conducteur?.poste?.name}})</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                    <div [class.loading]="!(allInscriptions$ | async)" *ngSwitchDefault>
                                        <select class="custom-select" formControlName="value">
                                            <option [value]="null">--Veuillez choisir--</option>
                                            <ng-container *ngFor="let item of (allInscriptions$ | async)">
                                                <option [ngValue]="item">{{item.nom }} {{item.prenom}} ({{item?.departement?.name}}-{{item?.poste?.name}})</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                </ng-container>
                            </div>
                            <button type="button" (click)="onAddFilter()" [disabled]="configForm.invalid"
                                class="btn btn-primary">Ajouter un filtre</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="card-body p-0" [class.loading]="dataHelper.loading$ | async" >
                <div class="p-3" *ngIf="filtres && filtres.length">
                    <button class="btn btn-sm btn-outline-primary mx-1" *ngFor="let filtre of filtres; let i = index"
                        (click)="onRemoveFilter(i)">
                        {{filtre.name | titlecase}} <i class="fas fa-times"></i>
                    </button>
                </div>
                <ng-container *ngIf="view == 'list'; else cardView">
                    <div class="table-responsive" *ngIf="dataHelper.data$ | async as items" >
                        <table class="table table-hover text-nowrap mb-0" *ngIf="items.length; else noItem">
                            <thead class="tx-10 tx-uppercase">
                                <tr>
                                    <th scope="col">Vehicule</th>
                                    <th scope="col">Immatriculation</th>
                                    <th scope="col">Etat</th>
                                    <th scope="col">Disponibilite</th>
                                    <th scope="col" class="text-center">Affectataire(s)</th>
                                    <th scope="col" class="text-center">Chauffeur</th>    
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let automobile of items;trackBy: dataHelper.trackByFn">
                                    <td class="align-middle">
                                        <a class="cursor-pointer" (click)="onSelectAuto(automobile)">
                                            <i class="fal fa-dot-circle fa-lg " [style.color]="automobile.etat ? automobile.etat.couleur : '' "></i>  {{automobile.libelle}}
                                        </a>
                                    </td>
                                    <td class="align-middle">
                                        <a class="cursor-pointer" (click)="onSelectAuto(automobile)">
                                            {{automobile.immatriculation}}
                                        </a>
                                    </td>
                                    <td class="align-middle">
                                        <div ngbDropdown container="body" class="d-inline-block">
                                            <button type="button" class="btn btn-sm btn-outline-default" [style.color]="getTextColor(automobile.etat ? automobile.etat.couleur : '')" [style.background-color]="automobile.etat ? automobile.etat.couleur : ''" ngbDropdownToggle> {{automobile.etat ? automobile.etat.libelle : automobile.etat_achat}} </button>
                                            <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                                <button *ngFor="let etat of (allEtatAutomobiles$|async);" (click)="onUpdateEtat(automobile,etat)" ngbDropdownItem> <i class="fal fa-dot-circle" [style.color]="etat.couleur"></i>  {{etat.libelle}}</button>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-success align-middle">
                                        Disponible
                                    </td>
                                    <td class="align-middle">
                                        <ul class="list-unstyled m-0 d-flex align-items-center justify-content-center">
                                            <li *ngFor="let equipe of automobile.affectataires | slice:0:4" class="mg-l--10"
                                                data-toggle="tooltip" data-placement="top" data-skin-class="tooltip-base"
                                                data-html="true" title="" data-original-title="Alison G">
                                                <div class="avatar"
                                                    [title]="equipe?.personnel?.nom+' '+equipe?.personnel?.prenom">
                                                    <img *ngIf="equipe?.personnel?.sexe == 'Masculin'"
                                                        src="assets/images/users/male.png"
                                                        class="avatar-initial border border-secondary rounded-circle">
                                                    <img *ngIf="equipe?.personnel?.sexe == 'Feminin'"
                                                        src="assets/images/users/female.png"
                                                        class="avatar-initial border border-secondary rounded-circle"
                                                        alt="">
                                                </div>
                                            </li>
                                            <li *ngIf="automobile.affectataires?.length > 4" class="mg-l--10" data-original-title=""
                                                title="">
                                                <div class="avatar"><span
                                                        class="bg-soft-primary avatar-initial rounded-circle bg-primary">{{automobile.affectataires.length - 4}}+</span>
                                                </div>
                                            </li>
                                        </ul>
                                    </td>
                                    <td class="align-middle">
                                        <div class="d-flex justify-content-center">
                                            <a *ngIf="automobile.conducteur?.conducteur" [routerLink]="['/transport/mes-chauffeurs', automobile.conducteur_id]">
                                                <div class="avatar"
                                                    [title]="automobile.conducteur?.conducteur.nom+' '+automobile.conducteur?.conducteur.prenom">
                                                    <img *ngIf="automobile.conducteur?.conducteur.sexe == 'Masculin'"
                                                        src="assets/images/users/male.png"
                                                        class="avatar-initial border border-secondary rounded-circle">
                                                    <img *ngIf="automobile.conducteur?.conducteur.sexe == 'Feminin'"
                                                        src="assets/images/users/female.png"
                                                        class="avatar-initial border border-secondary rounded-circle"
                                                        alt="">
                                                </div>
                                            </a>
                                        </div>
                                    </td>   
                                    <td class="align-middle">
                                        <a class="table-action cursor-pointer  mr-2" (click)="onSelectAuto(automobile)"><i class="fal fa-search tx-second "></i></a>
                                        <a class="table-action cursor-pointer mr-2 " container="body" [ngbTooltip]="'Modifier'"  (click)="onShowUpdateForm(automobile) "><i class="fal fa-edit tx-second "></i></a>
                                        <a class="table-action cursor-pointer mr-2 "  container="body" [ngbTooltip]="'Copier'" (click)="onShowCreateForm(automobile) "><i class="fal fa-clone tx-second "></i></a>
                                        <a class="table-action cursor-pointer mr-2 "  container="body" [ngbTooltip]="'Supprimer'" (click)="onDelete(automobile) "><i class="fal fa-times-square tx-second "></i></a>
    
                                    </td>
                                </tr>
                            </tbody>
                        </table>
    
                        <section *ngIf="dataHelper.hasMoreData " [fromRoot]="true" infiniteScroll [infiniteScrollDistance]="2 " [infiniteScrollThrottle]="50 " (scrolled)="dataHelper.loadData() ">
                        </section>
                    </div>
                </ng-container>
                
            </div>
        </div>
    </div>
    <div class="main-content2 scroll-11 " [class.main-content_large]="selectedAuto">
        <div class="card shadow mb-2 p-0" *ngIf="selectedAuto">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-2 d-flex justify-content-between align-items-center text-center">
                <span class="d-flex align-items-center">
                    <button class="btn btn-link  mr-3" [routerLink]="['./']">
                        <i class="fad fa-arrow-alt-left bg-light tx-success card-1"
                            style="padding:6px; border-radius:50%"></i>
                    </button>
                  
                    <h6 class="m-0 font-weight-bold text-secondary text-center">
                        {{selectedAuto.libelle}} 
                    </h6>    
                </span>
                <div class="float">
                    <div>
                        <ul class="nav float-right list-inline justify-content-end">
                            <li class="nav-item">
                                <button class="btn btn-link" container="body"
                                    [ngbTooltip]="'Supprimer'"
                                    (click)="onDelete(selectedAuto)">
                                    <span>
                                        <i class="fad card-1 fa-trash  tx-16 bg-danger text-white"
                                            style="padding:6px; border-radius:50%"></i>
                                    </span>
                                </button>
                            </li>
                            <li class="nav-item">
                                <a class="btn btn-link" container="body" ngbTooltip="Modifier"
                                    (click)="onShowUpdateForm(selectedAuto)">
                                    <span class="tx-echos">
                                        <i class="fal card-1 fa-pencil bg-light tx-16 tx-yeto"
                                            style="padding:6px; border-radius:50%"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item my-auto">
                                <div ngbDropdown container="body" class="d-inline-block">
                                    <button type="button" class="btn btn-sm btn-outline-default" [style.color]="getTextColor(selectedAuto.etat ? selectedAuto.etat.couleur : '')" [style.background-color]="selectedAuto.etat ? selectedAuto.etat.couleur : ''" ngbDropdownToggle> {{selectedAuto.etat ? selectedAuto.etat.libelle : selectedAuto.etat_achat}} </button>
                                    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                        <button *ngFor="let etat of (allEtatAutomobiles$|async);" (click)="onUpdateEtat(selectedAuto,etat)" ngbDropdownItem> <i class="fal fa-dot-circle" [style.color]="etat.couleur"></i>  {{etat.libelle}}</button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                
            </div>
            <!-- Card Body -->
            <div class="card-body p-1 pb-3">
                <div class="d-flex clearfix  mg-0 pd-0">
                    <div class="col-lg-2 p-0 " style="background:#f4f8f9; height:100vh ">
                        <nav class="monmenu nav flex-column  ">
                            
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'assurance'"
                                [class.bg-white]="fragment == 'assurance'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-car-crash tx-16  mr-2"></i>
                                    Assurance</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'calendrier'"
                                [class.bg-white]="fragment == 'calendrier'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-calendar tx-16  mr-2"></i>
                                    Calendrier</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'commande'"
                                [class.bg-white]="fragment == 'commande'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-file-signature tx-16  mr-2"></i>
                                    Commande</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'details'"
                                [class.bg-white]="fragment == 'details'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i
                                        class="fal fa-info-circle tx-16  mr-2"></i> Détails</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'entretien'"
                                [class.bg-white]="fragment == 'entretien'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-car-battery tx-16  mr-2"></i>
                                    Entretien</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'kilometrage'"
                                [class.bg-white]="fragment == 'kilometrage'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-tachometer tx-16  mr-2"></i>
                                    Kilometrage</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'mission'"
                                [class.bg-white]="fragment == 'mission'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-hiking tx-16  mr-2"></i>
                                    Missions</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'panne'"
                                [class.bg-white]="fragment == 'panne'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-car-garage tx-16  mr-2"></i>
                                    Panne & Bons</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'situation'"
                                [class.bg-white]="fragment == 'situation'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-map-marked tx-16  mr-2"></i>
                                    Situation</a>
                            </a>
                            <a [routerLink]="['./', selectedAuto.id]" [fragment]="'visite'"
                                [class.bg-white]="fragment == 'visite'"
                                class="d-flex align-items-center justify-content-between pb-2 pt-1 bd-b">
                                <a class="nav-link3 mx-2 tx-echos"><i class="fal fa-car-mechanic tx-16  mr-2"></i>
                                    Visite Technique</a>
                            </a> 
                        </nav>
                    </div>
    
                    <div class="col-lg-10">
                        <div [ngSwitch]="fragment">
                            <div *ngSwitchCase="'mission'">
                                <div class="table-responsive" [class.loading]="loading_missions">
                                    <table class="table table-hover text-nowrap" *ngIf="missions">
                                        <thead class="tx-10 tx-uppercase">
                                            <tr>
                                                <th>Mission</th>
                                                <th>Localite</th>
                                                <th>Departement</th>
                                                <th>Date</th>
                                                <th>Note</th>
                                                <th>Budget</th>
                                            </tr>
                                        </thead>
                                        <tbody *ngIf="missions?.length; else noItem">
                                            <tr *ngFor="let mission of missions" [routerLink]="'/mission/details/'+mission?.id+'/tab/default'" class="handMe">
                                                <td>
                                                    <a 
                                                        class="my-0 mt-1 text-primary">{{(mission.name.length>30)? (mission.name | slice:0:30)+'..':(mission.name)}}</a>
                                                    <p class="tx-12 mb-0">
                                                        {{mission?.type?.name}} <span class="text-primary">{{mission?.code}}</span>
                                                    </p>
                                                </td>
                                                <td>
                                                    <p class="my-0 font-weight-bold">{{mission?.ville.name}}</p>
                                                    <p>{{mission?.ville.pay.name}}</p>
                                                </td>
                                                <td>
                                                    {{mission?.departement.name}}
                                                </td>
                                                <td>{{mission.start | date:'d MMM y'}} - {{mission.end | date:'d MMM y'}}</td>
                                                <td>{{mission.avg_note ? mission.avg_note : 'Aucune note'}}</td>
                                                <td>
                                                    {{mission.total_budget}} 
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div *ngSwitchCase="'affectataire'">
                                <div class="d-flex justify-content-center">
                                    <div class="col-xl-3 col-sm-6" *ngFor="let affectataire of selectedAuto.affectataires">
                                        <div class="card card-profile-1 mb-3">
                                            <a class="card-body tx-center p-0">
                                                <div class="mx-auto my-2 avatar-md" *ngIf="!affectataire.personnel.avatar">
                                                    <div class="avatar-title bg-soft-primary text-primary display-6 m-0 rounded-circle"><i class="fas fa-3x fa-user-circle"></i></div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-2" *ngIf="affectataire.personnel.avatar">
                                                    <div class="image_outer_container {{affectataire.personnel.online_statut}}" >
                                                        <div class="icon_statut" ></div>
                                                        <div class="image_inner_container">
                                                            <img [src]="affectataire.personnel.avatar">
                                                        </div>
                                                    </div>
                                                </div>
                                                <h4 class="m-0 text-primary">
                                                    {{affectataire.personnel.nom }} {{affectataire.personnel.prenom}}
                                                </h4>
                                                <h6 class="m-0 tx-info">
                                                    {{affectataire.libelle}}
                                                </h6>
                                                <div class="p-2 tx-echos tx-center bg-soft-primary">
                                                    <span class="badge badge-primary mx-1 card-2"> ({{affectataire.personnel?.departement?.name}}-{{affectataire.personnel?.poste?.name}})</span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div *ngSwitchCase="'kilometrage'">
                                <app-kilometrage [automobileId]="selectedAuto.id"></app-kilometrage>
                            </div>
                            <div *ngSwitchCase="'entretien'">
                                <app-entretien [automobileId]="selectedAuto.id"></app-entretien>
                            </div>
                            <div *ngSwitchCase="'commande'">
                                <app-commande-automobile [automobileId]="selectedAuto.id"></app-commande-automobile>
                            </div>
                            <div *ngSwitchCase="'panne'">
                                <app-panne-automobile [automobileId]="selectedAuto.id"></app-panne-automobile>
                            </div>
                            <div *ngSwitchCase="'visite'">
                                <app-visite-technique [automobileId]="selectedAuto.id"></app-visite-technique>
                            </div>
                            <div *ngSwitchCase="'assurance'">
                                <app-assurance [automobileId]="selectedAuto.id"></app-assurance>
                            </div>
                            <div *ngSwitchCase="'calendrier'">
                                <app-calendar-ui [eventParent]="{name: 'trans_auto', id: selectedAuto.id}"></app-calendar-ui>
                            </div>
                            <div *ngSwitchCase="'situation'">
                                <div class="row">
                                    
                                </div>
                                <div class="row">
                                    <div class="col-xl-12">
                                        <div class="card">
                                            <div class="card-header justify-content-center">
                                                <h4 class="my-0">
                                                   <span class="text-info">Emplacement:</span> {{selectedAuto.emplacement?.libelle}}
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                
                                    <div class="col-xl-12">
                                        <div class="card">
                                            <div class="card-header justify-content-center">
                                                <h4 class="my-0">
                                                    <span class="text-warning">Chauffeur</span>
                                                </h4>
                                            </div>
                                            <div class="card-body p-0">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="table-responsive">
                                                            <table
                                                                class="table display mb-0 dataTablesCard table-responsive-xxl card-table"
                                                                id="example-5">
                                                                <thead>
                                                                    <tr class="border-top-primary">
                                                                        <th class="text-center">
                                                                            Image
                                                                         </th>
                                                                        <th>
                                                                           Nom
                                                                        </th>
                                                                        <th>
                                                                            Prenom
                                                                        </th>
                                                                        <th>
                                                                            Departement
                                                                        </th>
                                                                        <th> Poste </th>
                                                                        <th> Permis </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr class="cursor-pointer" [routerLink]="['/transport/mes-chauffeurs', selectedAuto.conducteur_id]">
                                                                        <td>
                                                                            <div class="d-flex justify-content-center">
                                                                                <a *ngIf="selectedAuto.conducteur" [routerLink]="['/transport/mes-chauffeurs', selectedAuto.conducteur_id]">
                                                                                    <div class="avatar"
                                                                                        [title]="selectedAuto.conducteur?.conducteur?.nom+' '+selectedAuto.conducteur?.conducteur?.prenom">
                                                                                        <img *ngIf="selectedAuto.conducteur?.conducteur?.sexe == 'Masculin'"
                                                                                            src="assets/images/users/male.png"
                                                                                            class="avatar-initial border border-secondary rounded-circle">
                                                                                        <img *ngIf="selectedAuto.conducteur?.conducteur?.sexe == 'Feminin'"
                                                                                            src="assets/images/users/female.png"
                                                                                            class="avatar-initial border border-secondary rounded-circle"
                                                                                            alt="">
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            {{selectedAuto.conducteur?.conducteur?.nom}}
                                                                        </td>
                                                                        <td>
                                                                            {{selectedAuto.conducteur?.conducteur?.prenom}}
                                                                        </td>
                                                                        <td>
                                                                            {{selectedAuto.conducteur?.conducteur?.departement?.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{selectedAuto.conducteur?.conducteur?.poste?.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{selectedAuto.conducteur?.numero_permis}}
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-12">
                                        <div class="card">
                                            <div class="card-header justify-content-center">
                                                <h4 class="my-0">
                                                   <span class="text-success">Affectataires</span>
                                                </h4>
                                            </div>
                                            <div class="card-body p-0">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="table-responsive">
                                                            <table
                                                                class="table display mb-0 dataTablesCard table-responsive-xxl card-table"
                                                                id="example-5">
                                                                <thead>
                                                                    <tr class="border-top-primary">
                                                                        <th class="text-center">
                                                                            Image
                                                                         </th>
                                                                        <th>
                                                                           Nom
                                                                        </th>
                                                                        <th>
                                                                            Prenom
                                                                        </th>
                                                                        <th>
                                                                            Departement
                                                                        </th>
                                                                        <th> Poste </th>
                                                                        <th> Permis </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr *ngFor="let affectataire of selectedAuto.affectataires">
                                                                        <td>
                                                                            <div class="d-flex justify-content-center">
                                                                                <a *ngIf="affectataire.personnel">
                                                                                    <div class="avatar"
                                                                                        [title]="affectataire.personnel.nom+' '+affectataire.personnel.prenom">
                                                                                        <img *ngIf="affectataire.personnel.sexe == 'Masculin'"
                                                                                            src="assets/images/users/male.png"
                                                                                            class="avatar-initial border border-secondary rounded-circle">
                                                                                        <img *ngIf="affectataire.personnel.sexe == 'Feminin'"
                                                                                            src="assets/images/users/female.png"
                                                                                            class="avatar-initial border border-secondary rounded-circle"
                                                                                            alt="">
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            {{affectataire.personnel.nom}}
                                                                        </td>
                                                                        <td>
                                                                            {{affectataire.personnel.prenom}}
                                                                        </td>
                                                                        <td>
                                                                            {{affectataire.personnel.departement?.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{affectataire.personnel.poste?.name}}
                                                                        </td>
                                                                        <td>
                                                                            {{affectataire.libelle}}
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
        
                                </div>
                            </div>
                            <div *ngSwitchDefault>
                                <section class="py-2 col-md-11  d-block mx-auto">
                                    <div class="row">
                                        
                                        <!-- Acquisition Group -->
                                         <div class="col-md-6">
                                            <div class="card mb-4">
                                                <div class="card-header bg-primary text-white">
                                                  Acquisition
                                                </div>
                                                <ul class="list-group list-group-flush">
                                                  <li class="list-group-item">
                                                    <strong>Acquisition:</strong> {{selectedAuto.type_acquisition | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Fournisseur:</strong> {{selectedAuto.coordonnee?.libelle | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Montant:</strong> {{selectedAuto.montant}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Etat à l'acquisition:</strong> {{selectedAuto.etat_achat | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Date de l'acquisition:</strong> {{selectedAuto.date_achat | date:'dd/MM/yyyy'}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Kilometrage à l'acquisition:</strong> {{selectedAuto.kilometrage_durant_achat}}
                                                  </li>
                                                </ul>
                                              </div>
                                         </div>
                                        
                                      
                                        <!-- Identification du véhicule Group -->
                                        <div class="col-md-6">
                                            <div class="card mb-4">
                                                <div class="card-header bg-success text-white">
                                                  Identification du véhicule
                                                </div>
                                                <ul class="list-group list-group-flush">
                                                  <li class="list-group-item">
                                                    <strong>Immatriculation:</strong> {{selectedAuto.immatriculation | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Numero chassis:</strong> {{selectedAuto.numero_chassis}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Marque:</strong> {{selectedAuto.marque?.libelle | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Modèle:</strong> {{selectedAuto.modele?.libelle | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Genre:</strong> {{selectedAuto.genre?.libelle | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Série:</strong> {{selectedAuto.serie?.libelle | titlecase}}
                                                  </li>
                                                </ul>
                                              </div>
                                        </div>

                                        <!-- Caractéristiques techniques Group -->
                                        <div class="col-md-6">
                                            <div class="card mb-4">
                                                <div class="card-header bg-warning text-dark">
                                                  Caractéristiques techniques
                                                </div>
                                                <ul class="list-group list-group-flush">
                                                  <li class="list-group-item">
                                                    <strong>Carburant:</strong> {{selectedAuto.type_carburant?.libelle | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Type:</strong> {{selectedAuto.type_automobile?.libelle | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Nombre de places:</strong> {{selectedAuto.nombre_place}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Nombre de portes:</strong> {{selectedAuto.nombre_porte}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Transmission:</strong> {{selectedAuto.type_transmission | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Emission CO2:</strong> {{selectedAuto.emission_co2 | titlecase}}
                                                  </li>
                                                  <li class="list-group-item">
                                                    <strong>Nombre de chevaux:</strong> {{selectedAuto.nombre_chevaux}}
                                                  </li>
                                                </ul>
                                              </div>
                                        </div>

                                        <!-- Image Group -->
                                        <div class="col-md-6">
                                            <img class="card-img mb-2" style="width: 100%;
                                    max-height: 20vw;
                                    object-fit: cover;" src="{{selectedAuto.image}}" [alt]="selectedAuto.libelle">
                                        </div>
                                        
                                      </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ADD -->
<div class="button-fixed-bottom-right" *ngIf="!selectedAuto">
    <button [disabled]="(dataHelper.loading$ | async)" (click)="onShowCreateForm();" title="Créer"  type="button"
      class="btn btn-primary btn-circle btn-lg">
      <i class="fas fa-plus-circle"></i>
    </button>
    <!-- <button *ngIf="currentView == 'add'" title="Fermer"
      (click)="addOrList(); setTitle('window', 'listMission'); removeItem()" type="button"
      class="btn btn-danger btn-circle btn-lg">
      <i class="fas fa-times"></i>
    </button> -->
</div>

<ng-template #noItem>
    <h5 class="text-center title m-2 p-5">
        {{ 'Aucun Element' }}
    </h5>
</ng-template>

<ng-template #cardView>
    <div [class.loading]="dataHelper.loading$ | async" 
        [scrollWindow]="false"
        infiniteScroll
        [infiniteScrollDistance]="2"
        [infiniteScrollThrottle]="50"
        (scrolled)="checkData()"
        class="scrollable-y-75 scroll-11">
        <ng-container *ngIf="dataHelper.data$ | async as items">
            <div class="card-group justify-content-around p-2" *ngIf="items.length; else noItem">
                <div *ngFor="let automobile of items;trackBy:  dataHelper.trackByFn" class="menu flip-card mb-3 col-12 col-sm-8 col-md-6 col-lg-4">
                    <div class="image-flip-2" [class.hover]="false">
                        <div class="mainflip">
                            <div class="frontside">
                                <div class="card card-1">
                                    <div class="card-header d-flex align-items-center p-0 justify-content-between">
                                        <a class="nav-link">
                                            <ul class="list-unstyled m-0 d-flex align-items-center justify-content-center">
                                                <li *ngFor="let equipe of automobile.affectataires | slice:0:1" class="mg-l--10"
                                                    data-toggle="tooltip" data-placement="top" data-skin-class="tooltip-base"
                                                    data-html="true" title="" data-original-title="Alison G">
                                                    <div class="avatar"
                                                        [title]="equipe?.personnel?.nom+' '+equipe?.personnel?.prenom">
                                                        <img *ngIf="equipe?.personnel?.sexe == 'Masculin'"
                                                            src="assets/images/users/male.png"
                                                            class="avatar-initial border border-secondary rounded-circle">
                                                        <img *ngIf="equipe?.personnel?.sexe == 'Feminin'"
                                                            src="assets/images/users/female.png"
                                                            class="avatar-initial border border-secondary rounded-circle"
                                                            alt="">
                                                    </div>
                                                </li>
                                                <li *ngIf="automobile.affectataires?.length > 1" class="mg-l--10" data-original-title=""
                                                    title="">
                                                    <div class="avatar"><span
                                                            class="bg-soft-primary avatar-initial rounded-circle bg-primary">{{automobile.affectataires.length - 1}}+</span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </a>
                                        <div ngbDropdown container="body" class="d-inline-block">
                                            <button type="button" class="btn btn-sm btn-outline-default" [style.color]="getTextColor(automobile.etat ? automobile.etat.couleur : '')" [style.background-color]="automobile.etat ? automobile.etat.couleur : ''" ngbDropdownToggle> {{automobile.etat ? automobile.etat.libelle : automobile.etat_achat}} </button>
                                            <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                                <button *ngFor="let etat of (allEtatAutomobiles$|async);" (click)="onUpdateEtat(automobile,etat)" ngbDropdownItem> <i class="fal fa-dot-circle" [style.color]="etat.couleur"></i>  {{etat.libelle}}</button>
                                            </div>
                                        </div>
                                        <a class="nav-link">
                                            <div class="avatar">
                                                <img
                                                    container="body"
                                                    [ngbTooltip]="'name'"
                                                    class="avatar-initial border border-secondary rounded-circle"
                                                    [src]="'assets/images/users/male.png'"
                                                    alt="avatar">
                                                <!-- <i *ngIf="!courrier.courrier?.suivi_par_user?.avatar"
                                                    container="body"
                                                    [ngbTooltip]="courrier.courrier?.suivi_par_user?.libelle"
                                                    class="fad fa-user-circle fa-2x"></i> -->
                                            </div>
                                        </a>
                                    </div>
                                    <img *ngIf="automobile.image" class="card-img cursor-pointer" style="width: 100%;
                                    height: 15vw;
                                    object-fit: cover;" (click)="onSelectAuto(automobile)" src="{{automobile.image}}" [alt]="automobile.libelle">
                                    <div *ngIf="!automobile.image" class="d-flex justify-content-center align-items-center" style="width: 100%; height: 15vw; object-fit: cover;">
                                        <i container="body" style="font-size: 10rem;" class="fad fa-car-bus"></i>
                                    </div>
                                    <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
                                        <h5 class="card-title">{{automobile.libelle | titlecase}}</h5>
                                        <h6 class="card-subtitle mb-2 text-success">Disponible</h6>
                                        <h6 class="card-subtitle mb-2 text-info" *ngIf="false">Visite technique</h6>
                                        <h6 class="card-subtitle mb-2 text-info" *ngIf="false">Mission</h6>
                                        <h6 class="card-subtitle mb-2 text-danger" *ngIf="false">Panne</h6>
                                        <!-- <a class="card-link">
                                            Commander
                                        </a>
                                        <a (click)="onSelectAuto(automobile)" class="card-link">Details</a> -->
                                    </div>
                                    <div class="card-footer d-flex justify-content-between align-items-center">
                                        <a class="table-action cursor-pointer  mr-2" (click)="onSelectAuto(automobile)"><i class="fal fa-search tx-second "></i></a>
                                        <a class="table-action cursor-pointer mr-2 " container="body" [ngbTooltip]="'Modifier'"  (click)="onShowUpdateForm(automobile) "><i class="fal fa-edit tx-second "></i></a>
                                        <a class="table-action cursor-pointer mr-2 "  container="body" [ngbTooltip]="'Copier'" (click)="onShowCreateForm(automobile) "><i class="fal fa-clone tx-second "></i></a>
                                        <a class="table-action cursor-pointer mr-2 "  container="body" [ngbTooltip]="'Supprimer'" (click)="onDelete(automobile) "><i class="fal fa-times-square tx-second "></i></a>    
                                    </div>
                                </div>
                            </div>
                            <div class="backside">
                                <div class="card card-1" (click)="onSelectAuto(automobile)">
                                    <h4 class="px-3 my-2">
                                        {{automobile.libelle}}
                                    </h4>
                                    <hr class="m-0">
                                    automobile
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
</ng-template>

<ng-template #loading>
    <div class="col-sm-6 mg-b-20" *ngFor="let e of [].constructor(5);">
        <div class="loading-card card h-100 w-100">
            <div class="image loading-placeholder">
            </div>
            <div class="bars">
                <div class="bar bar1 loading-placeholder"></div>
                <div class="bar bar2 loading-placeholder"></div>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #loadingLine>
    <div class="row">
        <div *ngFor="let e of [].constructor(5);" class="col-12 rounded-0">
            <div class="loading-card card h-100 w-100  rounded-0">
                <div class="bars h-100  p-2">
                    <div class="bar bar2 w-100 loading-placeholder  m-0"></div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #loadMore>
    <div class="col-12 d-flex justify-content-center"
        *ngIf="this.dataHelper.hasMoreData && !(this.dataHelper.loading$ | async)">
        <button class="btn btn-outline-primary btn-oblong" (click)="checkData()">
            Voir plus
        </button>
    </div>
</ng-template>